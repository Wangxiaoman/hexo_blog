title: java程序员需要了解的计算机工作原理
date: 2015-11-12 18:00:49
tags: [技术]
category: 技术
---

## 1、cpu
进程或者线程发出操作请求之后，cpu会分配时间片来处理。处理的时候将参数传递给cpu，cpu计算完将本地变量回写到栈（内存中）中，如果这种本地变量多次的操作，那么会cache到cpu的缓存中，cpu有寄存器、一级缓存、二级缓存、三级缓存。

<!--more-->

JVM只能发出操作指令，由OS完成具体的计算工作。

### cache line
一次拿一批的数据来处理（连续的一段内存区域，从内存中，修改的话也有响应的规则回写）。

### 缓存一致性
多个cpu如果加载了同一块内存数据，那么这部分数据将处于共享状态（Intel QPI技术）。

### 并发与征用
线程池中，如果在cpu密集型的情况下，如果线程非常多，cpu会频繁的切换上下文，负载增加，反倒会降低效率；
如果是IO密集型的系统中，本身就需要大量的线程，不在乎上下文切换的开销；

CPU密集型：系统大部分时间都在做计算任务。比如数学计算、循环、拷贝、查找、排序。
IO密集型：系统大部分时间都在等待IO的交互。

常规操作，CPU密集型，一般来说建议线程并发处理的数量是 CPU核数 +/- 1，这样可以基本实现无上下文切换。
IO操作（网络IO，磁盘IO，DB读写，缓存读写等等），一般来说会设定 线程数 = CPU核数*6。
锁，这种情况下是比较负载，需要根据锁的粒度进行分析（估算），比如ConcurrentHashMap中进行了分段，有16个Segment，那么是允许16个线程来并行的，但是也会出现热点问题（某一个Segment访问数量远远大于其他）。